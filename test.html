<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Js Test</title>
</head>

<body>

</body>

</html>


<!-- 
72af222000000000000100000000020000000003000000000400000000050000000006000000000700000000080000000009000000000a000000000bbc3a72650cbc3a72650d000000000e000000000f000000001400000000150000000016000000001700000013180000000319000000001a0000001e1b0000001e1c000000001d000000001e000000181f0000002e200000001e210000005a220000001e230000000824000000182500000018cf

72641320280000000029000000002a000000002b000000002c000000002d000000002e000000002f0000000030000000003100000000320000000033000000003400000000350000000036000000003700000000380000000039000000053a00000000cf

72 af 22 20 
00 00 00 00 00 01 00 00 00 00 02 00 00 00 00 03 00 00 00 00 04 00 00 00 00 05 00 00 00 00 06 00 00 00 00 07 00 00 00 00 08 00 00 00 00 09 00 00 00 00 0a 00 00 00 00 0b bc 3a 72 65 0c bc 3a 72 65 0d 00 00 00 00 0e 00 00 00 00 0f 00 00 00 00 14 00 00 00 00 15 00 00 00 00 16 00 00 00 00 17 00 00 00 13 18 00 00 00 03 19 00 00 00 00 1a 00 00 00 1e 1b 00 00 00 1e 1c 00 00 00 00 1d 00 00 00 00 1e 00 00 00 18 1f 00 00 00 2e 20 00 00 00 1e 21 00 00 00 5a 22 00 00 00 1e 23 00 00 00 08 24 00 00 00 18 25 00 00 00 18 cf

72 64 13 20 28 00 00 00 00 29 00 00 00 00 2a 00 00 00 00 2b 00 00 00 00 2c 00 00 00 00 2d 00 00 00 00 2e 00 00 00 00 2f 00 00 00 00 30 00 00 00 00 31 00 00 00 00 32 00 00 00 00 33 00 00 00 00 34 00 00 00 00 35 00 00 00 00 36 00 00 00 00 37 00 00 00 00 38 00 00 00 00 39 00 00 00 05 3a 00 00 00 00 cf 

71 ff 04
-->


<script type="text/javascript" src="test.js"></script>
<script type="text/javascript">
    const DEVICE_DATA_INTEGER_SERVICE_UUID = '8de47721-5496-4233-ae45-e4b306fe1180';
    const DEVICE_DATA_INTEGER_CHARACTERISTIC_UUID = '8de47721-5496-4233-ae45-e4b306fe1181';
    const pack1 = '72af222000000000000100000000020000000003000000000400000000050000000006000000000700000000080000000009000000000a000000000bbc3a72650cbc3a72650d000000000e000000000f000000001400000000150000000016000000001700000013180000000319000000001a0000001e1b0000001e1c000000001d000000001e000000181f0000002e200000001e210000005a220000001e230000000824000000182500000018cf';
    const pack2 = '72641320280000000029000000002a000000002b000000002c000000002d000000002e000000002f0000000030000000003100000000320000000033000000003400000000350000000036000000003700000000380000000039000000053a00000000cf';
    const pack3 = '71ff04';

    const allPack = [pack1, pack2, pack3];

    mapDataGen2(BLE_GATT_SERVICES, DEVICE_DATA_INTEGER_SERVICE_UUID, DEVICE_DATA_INTEGER_CHARACTERISTIC_UUID, allPack);

    function mapDataGen2(__BLE_GATT_SERVICES, __DEVICE_DATA_INTEGER_SERVICE_UUID, __DEVICE_DATA_INTEGER_CHARACTERISTIC_UUID, __allPack) {

        var result = [];
        console.log("mapDataGen2 __BLE_GATT_SERVICES==>", __BLE_GATT_SERVICES);
        console.log("mapDataGen2 allPack==>", allPack);

        const __BLE_GATT_SERVICES_TMP = __BLE_GATT_SERVICES?.[__DEVICE_DATA_INTEGER_SERVICE_UUID];
        console.log("mapDataGen2 __BLE_GATT_SERVICES_TMP==>", __BLE_GATT_SERVICES_TMP);
        if (isObjectEmpty(__BLE_GATT_SERVICES_TMP)) {
            return result;
        }

        const __BLE_GATT_SERVICES_TMP2 = __BLE_GATT_SERVICES_TMP?.characteristics?.[DEVICE_DATA_INTEGER_CHARACTERISTIC_UUID];
        console.log("mapDataGen2 __BLE_GATT_SERVICES_TMP2==>", __BLE_GATT_SERVICES_TMP2);
        if (isObjectEmpty(__BLE_GATT_SERVICES_TMP2)) {
            return result;
        }

        // 0x72 LEN # of IDs 32
        // 1 byte 1 byte 1 byte 1 byte
        // Â­Byte Position 0: Start Flag, Ox72 signals the start of Integers write payload.
        // Byte Position 1: Integer value for the byte length of the package (includes all header bytes and End Flag).
        // Byte Position 2: Integer value indicating how many Setting IDs to follow in Package.
        // Byte Position 3: Integer value 32 indicates the Setting Value Size 32 = 32-bit size.

        var finalArr = [];
        allPack.forEach((element, index) => {

            if (element != '71ff04') {
                console.log("mapDataGen2 index==>", index);
                console.log("mapDataGen2 element==>", element);
                const __element = addSeparatorInString(element, 2, ' ');
                console.log("mapDataGen2 __element==>", __element);
                const __elementArr = __element.split(" ");

                if (__elementArr?.[0] == 72) {
                    console.log("mapDataGen2 __elementArr==>", __elementArr);
                    const lengthHex = __elementArr[2];
                    const lengthDec = hexToDecimal(lengthHex);

                    console.log("mapDataGen2 hexToDecimal==>", lengthDec);

                    const __elementArrTmp = [...__elementArr];
                    __elementArrTmp.splice(0, 4);
                    console.log("mapDataGen2 __elementArrTmp==>", __elementArrTmp);

                    const __elementArrTmpChunk = chunk(__elementArrTmp, 5);
                    __elementArrTmpChunk.splice(-1);
                    console.log("mapDataGen2 __elementArrTmpChunk==>", __elementArrTmpChunk);

                    const __uuidData = __BLE_GATT_SERVICES_TMP2?.chunks[index]?.uuidData;
                    console.log("mapDataGen2 __uuidData==>", __uuidData);

                    if (isObjectEmpty(__uuidData)) {
                        return false;
                    }

                    console.log("mapDataGen2 __elementArrTmpChunk.length==>", __elementArrTmpChunk.length);
                    console.log("mapDataGen2 __uuidData.length==>", __uuidData.length);

                    if (__elementArrTmpChunk.length < __uuidData.length) {
                        return false;
                    }

                    __elementArrTmpChunk.forEach((characteristic, __index) => {
                        console.log("mapDataGen2 characteristic==>", characteristic);
                        const __characteristic = [...characteristic];
                        __characteristic.splice(0, 1);
                        console.log("mapDataGen2 __characteristic==>", __characteristic);
                        __characteristicHex = __characteristic.join("");
                        console.log("mapDataGen2 __characteristicHex==>", __characteristicHex);
                        const __characteristicDec = hexToDecimal(__characteristicHex);
                        console.log("mapDataGen2 __characteristicDec==>", __characteristicDec);

                        if (__uuidData?.[__index]?.value) {
                            __uuidData[__index].value.currentValue = __characteristicDec;
                        }
                    });

                    __BLE_GATT_SERVICES_TMP2.chunks[index].uuidData = __uuidData;
                }
            }
        });

        finalArr = __BLE_GATT_SERVICES_TMP2;
        console.log("mapDataGen2 finalArr==>", finalArr);
    }
</script>